trigger:
  - main  # Adjust according to your default branch

pool:
  vmImage: 'windows-latest'

variables:
  GITHUB_TOKEN: $(github_token)  # Reference the GitHub PAT stored as a secret variable

steps:
  - checkout: self
    persistCredentials: true

  - script: |
      git config --global user.name 'Nauman501'
      git config --global user.email 'kyaninauman229@gmail.com'
      git remote add github https://$(GITHUB_TOKEN)@github.com/Nauman501/AzureDevOpsGithub.git
      git fetch github main || true  # Fetch the remote state; ignore errors if branch doesn't exist
      git checkout main || git checkout -b main  # Switch to main branch, create if it doesn't exist
      git rebase github/main || true  # Rebase with the remote main branch
      git push github main --force
    displayName: 'Push to GitHub'
    env:
      GITHUB_TOKEN: $(github_token)
